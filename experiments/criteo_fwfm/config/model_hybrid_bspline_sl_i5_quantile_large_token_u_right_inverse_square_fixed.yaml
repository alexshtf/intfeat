experiment:
  name: criteo_fwfm_hybrid_bspline_qcap_large_token_sl_i5_fixed_u_right_inverse_square
  variant: hybrid_bspline_sl

model:
  integer:
    hybrid:
      # Only this integer column uses the SL basis; all other integer columns use B-splines.
      sl_columns: [I5]

    # Integer basis = B-splines by default, with quantile-based cap and a per-column LARGE overflow token.
    bspline:
      cap_max: 10000000
      cap_mode: quantile
      cap_quantile: 0.99
      cap_quantile_factor: 1.1
      positive_overflow: large_token

      input_map: log1p_cap_to_unit
      out_min: -1.0
      out_max: 1.0

      normalize_fn: clamp
      normalization_scale: 1.0
      degree: 3
      knots_config: 10

    # SL settings apply to I5 only (since hybrid.sl_columns=[I5]).
    # Uses quantile-based cap and LARGE overflow token, matching the B-spline setup.
    sl:
      cap_max: 10000000
      cap_mode: quantile
      positive_overflow: large_token
      hist:
        cutoff_quantile: 0.99
        cutoff_factor: 1.1

      # Fixed to the best 400k-contiguous hybrid run (trial 95) from:
      # journal/2026-02-19_hybrid_bspline_qcap_large_token_sl_i5_tune_400k_100t/results.json
      conductance:
        family: u_exp_valley
        u_exp_valley:
          u0: 0.5679351275204167
          left_slope: 0.15004981827198377
          right_slope: 0.509481171284692

      potential:
        family: u_right_inverse_square
        kappa: 0.7869681052568523
        eps: 0.01992236650781661
        x0: 0.0

